package isen.contactapp.view;

import isen.contactapp.App;
import isen.contactapp.database.PersonDao;
import isen.contactapp.model.Person;
import javafx.beans.value.ChangeListener;
import javafx.beans.value.ObservableValue;
import javafx.fxml.FXML;
import javafx.scene.control.Alert;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.Button;
import javafx.scene.control.ButtonType;
import javafx.scene.control.Label;
import javafx.scene.control.TextField;

public class DetailViewController {

	
	@FXML
	private TextField firstNameTxt,lastNameTxt,phoneTxt,emailTxt,nickTxt, adressTxt, adressTxt1,adressTxt2,adressTxt3;
	
	@FXML
	private Button returnBtn,deleteBtn1, updateBtn;
	
	@FXML
	private Label title;

    private boolean isModified = false;



	

	
	public void initialize() {
		System.out.println("Selected item: " +App.getDetailViewData());
		
		title.setText(App.getDetailViewData().getFirstName()+" - "+App.getDetailViewData().getLastName());
		
		// TODO Auto-generated constructor stub
		try {
			firstNameTxt.setText(App.getDetailViewData().getFirstName());
			lastNameTxt.setText(App.getDetailViewData().getLastName());
			emailTxt.setText(App.getDetailViewData().getEmailAddress());
			phoneTxt.setText(App.getDetailViewData().getPhoneNumber());
			nickTxt.setText(App.getDetailViewData().getNickname());
			
		} catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		
        // Add change listeners to text fields
        firstNameTxt.textProperty().addListener(new TextFieldChangeListener());
        lastNameTxt.textProperty().addListener(new TextFieldChangeListener());
        emailTxt.textProperty().addListener(new TextFieldChangeListener());
        phoneTxt.textProperty().addListener(new TextFieldChangeListener());
        nickTxt.textProperty().addListener(new TextFieldChangeListener());
		
        // Disable update button initially
        updateBtn.setDisable(true);
	}
	

	public void handleReturnBtn() {
		try {
			App.setRoot("ContactsListingView");
//			Stage stages = new Stage();
//			Parent root = FXMLLoader.load(getClass().getResource("/isen/contactapp/ContactsListingView.fxml"));
//			stages.setTitle("All Contacts");
//			stages.setScene(new Scene(root));
//			stages.show();
		} catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		
	}
	

	public void handleDeleteBtn() {
		try {
			
			Alert alert = new Alert(AlertType.CONFIRMATION, "Delete " + App.getDetailViewData().getFirstName() + " ?", ButtonType.YES, ButtonType.CANCEL);
			alert.showAndWait();

			if (alert.getResult() == ButtonType.YES) {
			    //do stuff
				 new PersonDao().deletePerson(App.getDetailViewData());
			}
		App.setRoot("ContactsListingView");
		} catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		
	}
	
    public void handleUpdateBtn() {
        // Implement update functionality here
        System.out.println("Update button clicked");
    }

    // Listener to detect changes in text fields
    private class TextFieldChangeListener implements ChangeListener<String> {
        @Override
        public void changed(ObservableValue<? extends String> observable, String oldValue, String newValue) {
            isModified = true;
            updateBtn.setDisable(false);
        }
    }

}
